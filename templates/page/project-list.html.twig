{% extends 'base.html.twig' %}

{% block title %}Projekt Übersicht
{% endblock %}

{% block body %}
  <main class="vh-100 vw-100 pt-3 pb-3 project-site">
<div class="container py-5">
  <div class="row g-4">

    <!-- Neues Projekt -->
    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
      <div class="card h-100 border-0 text-center shadow-sm d-flex align-items-center justify-content-center" style="height: 300px;">
        <a href="{{ path('project_create') }}" class="text-decoration-none text-primary fs-1">+</a>
        <p class="mt-2 mb-0">Neues Projekt</p>
      </div>
    </div>

    <!-- Echte Projekte aus der Datenbank -->
    {% for project in projects %}
    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h4 class="card-title">{{ project.title }}</h4>
          <p class="card-text text-muted">
            {% if project.description %}
              {{ project.description|length > 200 ? project.description|slice(0, 200) ~ '...' : project.description }}
            {% else %}
              Keine Beschreibung
            {% endif %}
          </p>
          <p class="card-text">
            <small class="text-muted">Erstellt {{ project.createdAt|date('d.m.Y') }}</small>
          </p>
          <div class="d-flex justify-content-between">
            <a href="{{ path('workspace', {projectId: project.id}) }}" class="btn btn-primary btn-sm">
              <i class="fas fa-edit"></i> Bearbeiten
            </a>
            <div class="btn-group btn-group-sm">
              <a href="{{ path('project_edit', {id: project.id}) }}" class="btn btn-outline-secondary btn-sm">
                <i class="fas fa-cog"></i>
              </a>
              <button class="btn btn-outline-danger btn-sm" onclick="deleteProject({{ project.id }}, '{{ project.title|e('js') }}')">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}

    <!-- Falls keine Projekte vorhanden -->
    {% if projects is empty %}
    <div class="col-12">
      <div class="text-center py-5">
        <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
        <h5 class="text-muted">Noch keine Projekte vorhanden</h5>
        <p class="text-muted">Erstelle dein erstes Projekt, um loszulegen!</p>
        <a href="{{ path('project_create') }}" class="btn btn-primary">
          <i class="fas fa-plus"></i> Erstes Projekt erstellen
        </a>
      </div>
    </div>
    {% endif %}

  </div>
</div>

  </main>

	<script type="module" src="{{ asset('build/editor.js') }}"></script>

  <script>
  function deleteProject(projectId, projectTitle) {
    if (confirm('Projekt "' + projectTitle + '" wirklich löschen?')) {
      // Form erstellen und absenden
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = '/project/' + projectId + '/delete';
      document.body.appendChild(form);
      form.submit();
    }
  }
  </script>

{% endblock %}